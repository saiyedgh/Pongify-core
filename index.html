<!DOCTYPE html>
<html>
  <head>
    <title>Tournament Scheduler</title>
    <style>
      *,
      *::after,
      *::before {
        box-sizing: border-box;
      }
      body {
        font-family: Arial, sans-serif !important;
        font-size: 20pt !important;
        /* Increase font size */
        background-color: #121212 !important;
        /* Dark background */
        color: #f5f5f5 !important;
        /* Light text */
      }
      main {
        padding: 25px;
        width: 50vw;
        margin: 0 auto;
      }
      .form-group {
        margin-bottom: 1em;
      }
      .form-group label {
        display: block;
        margin-bottom: 0.5em;
      }
      .form-group input {
        width: 100%;
        padding: 0.5em;
        font-size: 1em;
        background-color: #2b2b2b;
        /* Dark input fields */
        color: #f5f5f5;
        /* Light text */
        border: 1px solid #f5f5f5;
        /* Light border */
      }
      input[type="number"] {
        width: 300px;
      }
      table {
        width: 100%;
        margin-top: 2em;
        border-collapse: collapse;
        color: #f5f5f5;
        /* Light text */
      }
      th {
        background-color: #2b2b2b;
        /* Dark header */
        color: #f5f5f5;
        /* Light text */
      }
      td,
      th {
        border: 1px solid #ddd;
        padding: 8px;
        text-align: center;
      }
      button {
        background-color: #4caf50;
        /* Green */
        border: none;
        color: white;
        padding: 12px 24px;
        text-align: center;
        text-decoration: none;
        display: inline-block;
        font-size: 16px;
        margin: 4px 2px;
        cursor: pointer;
        border-radius: 4px;
        /* Rounded corners */
        transition: all 0.3s ease;
        /* Smooth transition for hover effect */
      }
      button:hover {
        background-color: #45a049;
        /* Darker green */
      }
      /* Responsive styles */
      @media (max-width: 992px) {
        main {
          width: 80vw;
          margin: 0 5px;
        }
      }

      @media screen and (max-width: 600px) {
        body {
          font-size: 16pt !important;
          /* Adjust font size for smaller screens */
        }
        main {
          padding: 0;
          width: 100vw;
        }
        .form-group input {
          width: 100% !important;
        }

        table {
          width: 100% !important;
          font-size: 14pt !important;
        }
      }
    </style>
  </head>
  <body>
    <main>
      <h2>Syed's Tournament Scheduler</h2>
      <div class="form-group">
        <label for="numPlayers">Enter number of players/teams from (2-9):</label>
        <input type="number" id="numPlayers" min="2" max="9"/>
      </div>
      <div id="playerInputs"></div>
      <div class="form-group">
        <label for="numRounds">Enter number of rounds from (1-4):</label>
        <input type="number" id="numRounds" min="1" max="4"/> <!-- Updated to 4 -->
      </div>
      <button onclick="generateSchedule()">Generate Schedule</button>
      <hr>
      <div id="schedule"></div>
      <hr>

      <div id="matchInputs"></div>
      <button onclick="calculateResults()">Calculate Results</button>
      <hr>
      <table id="pointsTable">
        <thead>
          <tr>
            <th>Name</th>
            <th>W</th>
            <th>L</th>
            <th>PF</th>
            <th>PA</th>
            <th>PD</th>
            <th>Points</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </main>

    <script>
      const numPlayersInput = document.getElementById("numPlayers");
      const playerInputsDiv = document.getElementById("playerInputs");
      const numRoundsInput = document.getElementById("numRounds");
      const scheduleDiv = document.getElementById("schedule");
      const matchInputsDiv = document.getElementById("matchInputs");
      const pointsTableBody = document.getElementById("pointsTable").querySelector("tbody");

      let players = [];
      let combinations = [];

      // VALIDATION
      function validateNumPlayersInput() {
        const numPlayers = numPlayersInput.value;
        const isValid = !isNaN(numPlayers) && numPlayers >= 2 && numPlayers <= 9;
        numPlayersInput.style.borderColor = isValid ? "" : "red";
        return isValid;
      }

      function validateNumRoundsInput() {
        const numRounds = numRoundsInput.value;
        const isValid = !isNaN(numRounds) && numRounds >= 1 && numRounds <= 4;  // Allow up to 4 rounds
        numRoundsInput.style.borderColor = isValid ? "" : "red";
        return isValid;
      }

      function validateMatchScores() {
        const matchInputs = matchInputsDiv.querySelectorAll("input[type=number]");
        let isValid = true;
        matchInputs.forEach(function (input) {
          const score = parseInt(input.value);
          if (isNaN(score) || score < 0) {
            input.style.borderColor = "red";
            isValid = false;
          } else {
            input.style.borderColor = "";
          }
        });
        return isValid;
      }

      function validateInputs() {
        return validateNumPlayersInput() && validateNumRoundsInput() && validateMatchScores();
      }

      function shuffle(array) {
        var currentIndex = array.length,
          temporaryValue,
          randomIndex;
        while (0 !== currentIndex) {
          randomIndex = Math.floor(Math.random() * currentIndex);
          currentIndex -= 1;
          temporaryValue = array[currentIndex];
          array[currentIndex] = array[randomIndex];
          array[randomIndex] = temporaryValue;
        }
        return array;
      }

      numPlayersInput.addEventListener("change", function () {
        const numPlayers = numPlayersInput.value;
        playerInputsDiv.innerHTML = "";
        for (let i = 0; i < numPlayers; i++) {
          const div = document.createElement("div");
          div.className = "form-group";
          const label = document.createElement("label");
          label.textContent = `Enter player/team ${i + 1} name:`;
          const input = document.createElement("input");
          input.id = `player${i + 1}`;
          div.appendChild(label);
          div.appendChild(input);
          playerInputsDiv.appendChild(div);
        }
        if (numPlayers > 0) {
          document.getElementById(`player1`).focus();
        }
      });

      numPlayersInput.addEventListener("input", validateNumPlayersInput);
      numRoundsInput.addEventListener("input", validateNumRoundsInput);

      function generateSchedule() {
        if (!validateInputs()) {
          return;
        }

        players = [];
        const numPlayers = parseInt(numPlayersInput.value);
        const numRounds = parseInt(numRoundsInput.value);
        for (let i = 0; i < numPlayers; i++) {
          const playerInput = document.getElementById(`player${i + 1}`);
          players.push(playerInput.value);
        }

        // Handle special case for 2 players
        if (numPlayers === 2) {
          scheduleDiv.innerHTML = "";
          matchInputsDiv.innerHTML = "";
          for (let i = 0; i < numRounds; i++) {
            const p = document.createElement("p");
            p.textContent = `Match ${i + 1}: ${players[0]} vs ${players[1]}`;
            scheduleDiv.appendChild(p);

            const div = document.createElement("div");
            div.className = "form-group";
            const label = document.createElement("label");
            label.innerHTML = `Enter score for Match ${i + 1}: <br>${players[0]} vs ${players[1]}`;
            const input1 = document.createElement("input");
            input1.id = `match${i + 1}player1Score`;
            input1.type = "number";
            input1.style.width = "200px";
            input1.addEventListener("input", validateMatchScores);

            const input2 = document.createElement("input");
            input2.id = `match${i + 1}player2Score`;
            input2.type = "number";
            input2.style.width = "200px";
            input2.addEventListener("input", validateMatchScores);

            div.appendChild(label);
            div.appendChild(input1);
            div.appendChild(document.createTextNode(" vs "));
            div.appendChild(input2);
            matchInputsDiv.appendChild(div);
          }
          return;
        }

        // For more than 2 players, use the original scheduling logic
        combinations = [];
        for (let i = 0; i < numRounds; i++) {
          for (let j = 0; j < players.length; j++) {
            for (let k = j + 1; k < players.length; k++) {
              combinations.push([players[j], players[k]]);
            }
          }
        }

        combinations = shuffle(combinations);

        let schedule = [];
        let playerMatchCount = {};
        players.forEach(player => playerMatchCount[player] = 0);

        while (combinations.length > 0) {
          let addedMatch = false;
          for (let i = 0; i < combinations.length; i++) {
            let match = combinations[i];
            let [player1, player2] = match;

            if (schedule.length > 0) {
              let lastMatch = schedule[schedule.length - 1];
              if ((lastMatch[0] === player1 && lastMatch[1] === player2) || (lastMatch[0] === player2 && lastMatch[1] === player1)) {
                continue;
              }
            }

            if (playerMatchCount[player1] >= 2 || playerMatchCount[player2] >= 2) {
              continue;
            }

            schedule.push(match);
            playerMatchCount[player1] += 1;
            playerMatchCount[player2] += 1;

            for (let player of players) {
              if (player !== player1 && player !== player2) {
                playerMatchCount[player] = 0;
              }
            }

            combinations.splice(i, 1);
            addedMatch = true;
            break;
          }

          if (!addedMatch) {
            break;
          }
        }

        scheduleDiv.innerHTML = "";
        matchInputsDiv.innerHTML = "";

        schedule.forEach(function (combination, index) {
          const p = document.createElement("p");
          p.textContent = `Match ${index + 1}: ${combination[0]} vs ${combination[1]}`;
          scheduleDiv.appendChild(p);

          const div = document.createElement("div");
          div.className = "form-group";
          const label = document.createElement("label");
          label.innerHTML = `Enter score for Match ${index + 1}: <br>${combination[0]} vs ${combination[1]}`;
          const input1 = document.createElement("input");
          input1.id = `match${index + 1}player1Score`;
          input1.type = "number";
          input1.style.width = "200px";
          input1.addEventListener("input", validateMatchScores);

          const input2 = document.createElement("input");
          input2.id = `match${index + 1}player2Score`;
          input2.type = "number";
          input2.style.width = "200px";
          input2.addEventListener("input", validateMatchScores);

          div.appendChild(label);
          div.appendChild(input1);
          div.appendChild(document.createTextNode(" vs "));
          div.appendChild(input2);
          matchInputsDiv.appendChild(div);
        });
      }

      function calculateResults() {
        if (!validateInputs()) {
          return;
        }

        let results = {};
        players.forEach(player => {
          results[player] = {
            W: 0,
            L: 0,
            PF: 0,
            PA: 0,
            PD: 0,
            Points: 0
          };
        });

        const numRounds = parseInt(numRoundsInput.value);
        for (let i = 0; i < numRounds; i++) {
          const player1Score = parseInt(document.getElementById(`match${i + 1}player1Score`).value);
          const player2Score = parseInt(document.getElementById(`match${i + 1}player2Score`).value);

          const player1 = players[0];
          const player2 = players[1];

          results[player1].PF += player1Score;
          results[player1].PA += player2Score;
          results[player2].PF += player2Score;
          results[player2].PA += player1Score;

          if (player1Score > player2Score) {
            results[player1].W += 1;
            results[player2].L += 1;
          } else if (player2Score > player1Score) {
            results[player2].W += 1;
            results[player1].L += 1;
          }

          results[player1].PD = results[player1].PF - results[player1].PA;
          results[player2].PD = results[player2].PF - results[player2].PA;
        }

        pointsTableBody.innerHTML = "";
        players.forEach(player => {
          const row = document.createElement("tr");
          row.innerHTML = `
            <td>${player}</td>
            <td>${results[player].W}</td>
            <td>${results[player].L}</td>
            <td>${results[player].PF}</td>
            <td>${results[player].PA}</td>
            <td>${results[player].PD}</td>
            <td>${results[player].W * 2}</td>
          `;
          pointsTableBody.appendChild(row);
        });
      }
    </script>
  </body>
</html>

